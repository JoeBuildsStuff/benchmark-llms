# LLM Cost Calculator

This script calculates and adds cost information to LLM response JSON files generated by the `get-llm-answers.py` script. It processes token usage data and applies model-specific pricing to determine the cost of each API call.

## Features

- Calculates costs based on prompt and completion token usage
- Supports different pricing tiers for various models
- Handles reasoning token costs for Claude models
- Calculates total costs across all responses in a file
- Can process individual files or entire directories
- Preserves all original data while adding cost information

## Usage

```bash
python calculate_costs.py INPUT_PATH [--output-dir OUTPUT_DIR] [--recursive]
```

### Arguments

- `INPUT_PATH`: Path to a JSON file or directory containing JSON files to process
- `--output-dir`: Directory to save processed files (if not specified, original files will be overwritten)
- `--recursive`: Process JSON files in subdirectories recursively

### Examples

```bash
# Process a single file, overwriting the original
python calculate_costs.py outputs/gpt_4o_20240520_123456.json

# Process all files in a directory, saving to a new location
python calculate_costs.py outputs/ --output-dir processed_outputs/

# Process files recursively through subdirectories
python calculate_costs.py outputs/ --recursive --output-dir processed_outputs/
```

## Cost Calculation

The script calculates costs using the following formula:
- Prompt cost = (prompt_tokens × input_price_per_million_tokens) ÷ 1,000,000
- Completion cost = (completion_tokens × output_price_per_million_tokens) ÷ 1,000,000
- Reasoning cost (for Claude models) = (reasoning_tokens × output_price_per_million_tokens) ÷ 1,000,000
- Total cost = prompt_cost + completion_cost

## Output Format

The script adds the following to each response in the JSON file:
```json
"costs": {
  "prompt_cost": 0.0123,
  "completion_cost": 0.0456,
  "reasoning_cost": 0.0234,
  "total_cost": 0.0579
}
```

And adds the following to the metadata section:
```json
"costs": {
  "total_prompt_cost": 0.123,
  "total_completion_cost": 0.456,
  "total_reasoning_cost": 0.234,
  "total_cost": 0.579
}
```

## Dependencies

- json
- os
- argparse
- glob
- datetime 